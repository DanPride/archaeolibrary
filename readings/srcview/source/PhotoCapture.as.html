<!-- saved from url=(0014)about:internet -->
<!DOCTYPE html PUBLIC "-//W3C//DTD XHTML 1.0 Transitional//EN" "http://www.w3.org/TR/xhtml1/DTD/xhtml1-transitional.dtd">
<html xmlns="http://www.w3.org/1999/xhtml">
<head>
<meta http-equiv="Content-Type" content="text/html; charset=utf-8"/>
<title>PhotoCapture.as</title>
<link rel="stylesheet" type="text/css" href="../SourceStyles.css"/>
</head>

<body><pre><span class="ActionScriptReserved">import</span> <span class="ActionScriptDefault_Text">flash</span><span class="ActionScriptOperator">.</span><span class="ActionScriptDefault_Text">display</span><span class="ActionScriptOperator">.</span><span class="ActionScriptDefault_Text">Bitmap</span>;
<span class="ActionScriptReserved">import</span> <span class="ActionScriptDefault_Text">flash</span><span class="ActionScriptOperator">.</span><span class="ActionScriptDefault_Text">net</span><span class="ActionScriptOperator">.</span><span class="ActionScriptDefault_Text">FileReference</span>;
<span class="ActionScriptReserved">import</span> <span class="ActionScriptDefault_Text">flash</span><span class="ActionScriptOperator">.</span><span class="ActionScriptDefault_Text">utils</span><span class="ActionScriptOperator">.</span><span class="ActionScriptDefault_Text">ByteArray</span>;

<span class="ActionScriptReserved">import</span> <span class="ActionScriptDefault_Text">mx</span><span class="ActionScriptOperator">.</span><span class="ActionScriptDefault_Text">collections</span><span class="ActionScriptOperator">.</span><span class="ActionScriptDefault_Text">ArrayCollection</span>;
<span class="ActionScriptReserved">import</span> <span class="ActionScriptDefault_Text">mx</span><span class="ActionScriptOperator">.</span><span class="ActionScriptDefault_Text">controls</span><span class="ActionScriptOperator">.</span><span class="ActionScriptDefault_Text">Alert</span>;
<span class="ActionScriptReserved">import</span> <span class="ActionScriptDefault_Text">mx</span><span class="ActionScriptOperator">.</span><span class="ActionScriptDefault_Text">controls</span><span class="ActionScriptOperator">.</span><span class="ActionScriptDefault_Text">Image</span>;
<span class="ActionScriptReserved">import</span> <span class="ActionScriptDefault_Text">mx</span><span class="ActionScriptOperator">.</span><span class="ActionScriptDefault_Text">events</span><span class="ActionScriptOperator">.</span><span class="ActionScriptDefault_Text">DropdownEvent</span>;
<span class="ActionScriptReserved">import</span> <span class="ActionScriptDefault_Text">mx</span><span class="ActionScriptOperator">.</span><span class="ActionScriptDefault_Text">graphics</span><span class="ActionScriptOperator">.</span><span class="ActionScriptDefault_Text">ImageSnapshot</span>;
<span class="ActionScriptReserved">import</span> <span class="ActionScriptDefault_Text">mx</span><span class="ActionScriptOperator">.</span><span class="ActionScriptDefault_Text">graphics</span><span class="ActionScriptOperator">.</span><span class="ActionScriptDefault_Text">codec</span><span class="ActionScriptOperator">.</span><span class="ActionScriptDefault_Text">JPEGEncoder</span>;
<span class="ActionScriptReserved">import</span> <span class="ActionScriptDefault_Text">mx</span><span class="ActionScriptOperator">.</span><span class="ActionScriptDefault_Text">graphics</span><span class="ActionScriptOperator">.</span><span class="ActionScriptDefault_Text">codec</span><span class="ActionScriptOperator">.</span><span class="ActionScriptDefault_Text">PNGEncoder</span>;
<span class="ActionScriptReserved">import</span> <span class="ActionScriptDefault_Text">mx</span><span class="ActionScriptOperator">.</span><span class="ActionScriptDefault_Text">utils</span><span class="ActionScriptOperator">.</span><span class="ActionScriptDefault_Text">Base64Encoder</span>;
<span class="ActionScriptReserved">public</span> <span class="ActionScriptvar">var</span> <span class="ActionScriptDefault_Text">theImageByteArray</span>:<span class="ActionScriptDefault_Text">ByteArray</span>;
<span class="ActionScriptBracket/Brace">[</span><span class="ActionScriptMetadata">Bindable</span><span class="ActionScriptBracket/Brace">]</span><span class="ActionScriptReserved">protected</span> <span class="ActionScriptvar">var</span> <span class="ActionScriptDefault_Text">cameraNames</span>:<span class="ActionScriptDefault_Text">Array</span>;
<span class="ActionScriptBracket/Brace">[</span><span class="ActionScriptMetadata">Bindable</span><span class="ActionScriptBracket/Brace">]</span><span class="ActionScriptReserved">public</span> <span class="ActionScriptvar">var</span> <span class="ActionScriptDefault_Text">bitmap</span>:<span class="ActionScriptDefault_Text">Bitmap</span>;
<span class="ActionScriptBracket/Brace">[</span><span class="ActionScriptMetadata">Bindable</span><span class="ActionScriptBracket/Brace">]</span><span class="ActionScriptReserved">public</span> <span class="ActionScriptvar">var</span> <span class="ActionScriptDefault_Text">bitmapPath</span>:<span class="ActionScriptDefault_Text">String</span>;
<span class="ActionScriptComment">//[Bindable]protected var jpegSnapshot:im
</span><span class="ActionScriptReserved">protected</span> <span class="ActionScriptvar">var</span> <span class="ActionScriptDefault_Text">theimage</span>:<span class="ActionScriptDefault_Text">Image</span>;
<span class="ActionScriptReserved">private</span> <span class="ActionScriptvar">var</span> <span class="ActionScriptDefault_Text">theCameraIndex</span>:<span class="ActionScriptDefault_Text">int</span> <span class="ActionScriptOperator">=</span> 1;

<span class="ActionScriptReserved">private</span> <span class="ActionScriptfunction">function</span> <span class="ActionScriptDefault_Text">videoDisplay_listCameras</span><span class="ActionScriptBracket/Brace">(</span><span class="ActionScriptBracket/Brace">)</span>:<span class="ActionScriptReserved">void</span> 
<span class="ActionScriptBracket/Brace">{</span>
    <span class="ActionScriptvar">var</span> <span class="ActionScriptDefault_Text">cams</span>:<span class="ActionScriptDefault_Text">Array</span> <span class="ActionScriptOperator">=</span> <span class="ActionScriptReserved">new</span> <span class="ActionScriptDefault_Text">Array</span><span class="ActionScriptBracket/Brace">(</span><span class="ActionScriptString">"Select Camera"</span><span class="ActionScriptBracket/Brace">)</span>;
    <span class="ActionScriptvar">var</span> <span class="ActionScriptDefault_Text">camsList</span>:<span class="ActionScriptDefault_Text">Array</span> <span class="ActionScriptOperator">=</span> <span class="ActionScriptDefault_Text">Camera</span><span class="ActionScriptOperator">.</span><span class="ActionScriptDefault_Text">names</span>;
    <span class="ActionScriptDefault_Text">cameraNames</span> <span class="ActionScriptOperator">=</span> <span class="ActionScriptDefault_Text">cams</span><span class="ActionScriptOperator">.</span><span class="ActionScriptDefault_Text">concat</span><span class="ActionScriptBracket/Brace">(</span><span class="ActionScriptDefault_Text">camsList</span><span class="ActionScriptBracket/Brace">)</span>;
<span class="ActionScriptBracket/Brace">}</span>

<span class="ActionScriptReserved">protected</span> <span class="ActionScriptfunction">function</span> <span class="ActionScriptDefault_Text">cameraSelect_closeHandler</span><span class="ActionScriptBracket/Brace">(</span><span class="ActionScriptDefault_Text">event</span>:<span class="ActionScriptDefault_Text">DropdownEvent</span><span class="ActionScriptBracket/Brace">)</span>:<span class="ActionScriptReserved">void</span>
<span class="ActionScriptBracket/Brace">{</span>
    <span class="ActionScriptDefault_Text">theCameraIndex</span> <span class="ActionScriptOperator">=</span> <span class="ActionScriptDefault_Text">cameraSelect</span><span class="ActionScriptOperator">.</span><span class="ActionScriptDefault_Text">selectedIndex</span>;
    <span class="ActionScriptvar">var</span> <span class="ActionScriptDefault_Text">camera</span>:<span class="ActionScriptDefault_Text">Camera</span> <span class="ActionScriptOperator">=</span> <span class="ActionScriptDefault_Text">Camera</span><span class="ActionScriptOperator">.</span><span class="ActionScriptDefault_Text">getCamera</span><span class="ActionScriptBracket/Brace">(</span><span class="ActionScriptDefault_Text">Camera</span><span class="ActionScriptOperator">.</span><span class="ActionScriptDefault_Text">names</span><span class="ActionScriptBracket/Brace">[</span><span class="ActionScriptDefault_Text">theCameraIndex</span><span class="ActionScriptBracket/Brace">]</span><span class="ActionScriptBracket/Brace">)</span>;
    <span class="ActionScriptReserved">if</span> <span class="ActionScriptBracket/Brace">(</span><span class="ActionScriptDefault_Text">camera</span><span class="ActionScriptBracket/Brace">)</span> <span class="ActionScriptBracket/Brace">{</span>
        <span class="ActionScriptDefault_Text">videoDisplay</span><span class="ActionScriptOperator">.</span><span class="ActionScriptDefault_Text">attachCamera</span><span class="ActionScriptBracket/Brace">(</span><span class="ActionScriptDefault_Text">camera</span><span class="ActionScriptBracket/Brace">)</span>;
    <span class="ActionScriptBracket/Brace">}</span> 
<span class="ActionScriptBracket/Brace">}</span>
<span class="ActionScriptReserved">private</span> <span class="ActionScriptfunction">function</span> <span class="ActionScriptDefault_Text">videoDisplay_creationComplete</span><span class="ActionScriptBracket/Brace">(</span><span class="ActionScriptBracket/Brace">)</span>:<span class="ActionScriptReserved">void</span> 
<span class="ActionScriptBracket/Brace">{</span>
    <span class="ActionScriptDefault_Text">theCameraIndex</span> <span class="ActionScriptOperator">=</span> <span class="ActionScriptDefault_Text">cameraSelect</span><span class="ActionScriptOperator">.</span><span class="ActionScriptDefault_Text">selectedIndex</span>;
    <span class="ActionScriptvar">var</span> <span class="ActionScriptDefault_Text">camera</span>:<span class="ActionScriptDefault_Text">Camera</span> <span class="ActionScriptOperator">=</span> <span class="ActionScriptDefault_Text">Camera</span><span class="ActionScriptOperator">.</span><span class="ActionScriptDefault_Text">getCamera</span><span class="ActionScriptBracket/Brace">(</span><span class="ActionScriptDefault_Text">Camera</span><span class="ActionScriptOperator">.</span><span class="ActionScriptDefault_Text">names</span><span class="ActionScriptBracket/Brace">[</span><span class="ActionScriptDefault_Text">theCameraIndex</span><span class="ActionScriptBracket/Brace">]</span><span class="ActionScriptBracket/Brace">)</span>;
    <span class="ActionScriptReserved">if</span> <span class="ActionScriptBracket/Brace">(</span><span class="ActionScriptDefault_Text">camera</span><span class="ActionScriptBracket/Brace">)</span> <span class="ActionScriptBracket/Brace">{</span>
        <span class="ActionScriptDefault_Text">videoDisplay</span><span class="ActionScriptOperator">.</span><span class="ActionScriptDefault_Text">attachCamera</span><span class="ActionScriptBracket/Brace">(</span><span class="ActionScriptDefault_Text">camera</span><span class="ActionScriptBracket/Brace">)</span>;
    <span class="ActionScriptBracket/Brace">}</span> 
<span class="ActionScriptBracket/Brace">}</span>

<span class="ActionScriptReserved">protected</span> <span class="ActionScriptfunction">function</span> <span class="ActionScriptDefault_Text">onLoad</span><span class="ActionScriptBracket/Brace">(</span><span class="ActionScriptBracket/Brace">)</span>:<span class="ActionScriptReserved">void</span> {}<span class="ActionScriptComment">//Security.loadPolicyFile("http://88.208.202.35/crossdomain.xml");
</span><span class="ActionScriptReserved">public</span> <span class="ActionScriptvar">var</span> <span class="ActionScriptDefault_Text">theByteString</span>:<span class="ActionScriptDefault_Text">String</span>;
<span class="ActionScriptReserved">public</span> <span class="ActionScriptfunction">function</span> <span class="ActionScriptDefault_Text">takeSnapshot</span><span class="ActionScriptBracket/Brace">(</span><span class="ActionScriptBracket/Brace">)</span>:<span class="ActionScriptReserved">void</span>
<span class="ActionScriptBracket/Brace">{</span>
    <span class="ActionScriptvar">var</span> <span class="ActionScriptDefault_Text">snapshot</span>:<span class="ActionScriptDefault_Text">BitmapData</span> <span class="ActionScriptOperator">=</span> <span class="ActionScriptDefault_Text">ImageSnapshot</span><span class="ActionScriptOperator">.</span><span class="ActionScriptDefault_Text">captureBitmapData</span><span class="ActionScriptBracket/Brace">(</span><span class="ActionScriptDefault_Text">videoDisplay</span><span class="ActionScriptBracket/Brace">)</span>;
    <span class="ActionScriptvar">var</span> <span class="ActionScriptDefault_Text">JpgEnc</span>:<span class="ActionScriptDefault_Text">JPEGEncoder</span> <span class="ActionScriptOperator">=</span> <span class="ActionScriptReserved">new</span> <span class="ActionScriptDefault_Text">JPEGEncoder</span><span class="ActionScriptBracket/Brace">(</span>100<span class="ActionScriptBracket/Brace">)</span>;
    <span class="ActionScriptDefault_Text">theImageByteArray</span> <span class="ActionScriptOperator">=</span> <span class="ActionScriptDefault_Text">JpgEnc</span><span class="ActionScriptOperator">.</span><span class="ActionScriptDefault_Text">encode</span><span class="ActionScriptBracket/Brace">(</span><span class="ActionScriptDefault_Text">snapshot</span><span class="ActionScriptBracket/Brace">)</span>;
    <span class="ActionScriptvar">var</span> <span class="ActionScriptDefault_Text">BaseE</span>:<span class="ActionScriptDefault_Text">Base64Encoder</span> <span class="ActionScriptOperator">=</span> <span class="ActionScriptReserved">new</span> <span class="ActionScriptDefault_Text">Base64Encoder</span><span class="ActionScriptBracket/Brace">(</span><span class="ActionScriptBracket/Brace">)</span>;
    <span class="ActionScriptDefault_Text">BaseE</span><span class="ActionScriptOperator">.</span><span class="ActionScriptDefault_Text">encodeBytes</span><span class="ActionScriptBracket/Brace">(</span><span class="ActionScriptDefault_Text">theImageByteArray</span><span class="ActionScriptBracket/Brace">)</span>;
    <span class="ActionScriptDefault_Text">theByteString</span> <span class="ActionScriptOperator">=</span> <span class="ActionScriptDefault_Text">BaseE</span><span class="ActionScriptOperator">.</span><span class="ActionScriptDefault_Text">toString</span><span class="ActionScriptBracket/Brace">(</span><span class="ActionScriptBracket/Brace">)</span>;
    <span class="ActionScriptDefault_Text">bitmap</span><span class="ActionScriptOperator">=</span> <span class="ActionScriptReserved">new</span> <span class="ActionScriptDefault_Text">Bitmap</span><span class="ActionScriptBracket/Brace">(</span><span class="ActionScriptDefault_Text">snapshot</span><span class="ActionScriptBracket/Brace">)</span>;
    <span class="ActionScriptDefault_Text">img</span><span class="ActionScriptOperator">.</span><span class="ActionScriptDefault_Text">source</span><span class="ActionScriptOperator">=</span><span class="ActionScriptDefault_Text">bitmap</span>;
    <span class="ActionScriptComment">//var jpegSnapshot:ImageSnapshot = ImageSnapshot.captureImage(img, 0, jPEGEncoder);
</span><span class="ActionScriptBracket/Brace">}</span>

<span class="ActionScriptReserved">protected</span> <span class="ActionScriptfunction">function</span> <span class="ActionScriptDefault_Text">objectGrid_clickHandler</span><span class="ActionScriptBracket/Brace">(</span><span class="ActionScriptBracket/Brace">)</span>:<span class="ActionScriptReserved">void</span>
<span class="ActionScriptBracket/Brace">{</span>
    <span class="ActionScriptvar">var</span> <span class="ActionScriptDefault_Text">theClickName</span>:<span class="ActionScriptDefault_Text">String</span>;
    <span class="ActionScriptDefault_Text">img</span><span class="ActionScriptOperator">.</span><span class="ActionScriptDefault_Text">visible</span> <span class="ActionScriptOperator">=</span> <span class="ActionScriptReserved">true</span>;
    <span class="ActionScriptDefault_Text">theClickName</span> <span class="ActionScriptOperator">=</span> <span class="ActionScriptDefault_Text">objectGrid</span><span class="ActionScriptOperator">.</span><span class="ActionScriptDefault_Text">selectedItem</span><span class="ActionScriptOperator">.</span><span class="ActionScriptDefault_Text">NameCol</span>;
    <span class="ActionScriptDefault_Text">theFolder</span> <span class="ActionScriptOperator">=</span> <span class="ActionScriptDefault_Text">theClickName</span><span class="ActionScriptOperator">.</span><span class="ActionScriptDefault_Text">substr</span><span class="ActionScriptBracket/Brace">(</span>0<span class="ActionScriptOperator">,</span>6<span class="ActionScriptBracket/Brace">)</span>;
    <span class="ActionScriptDefault_Text">theFile</span> <span class="ActionScriptOperator">=</span> <span class="ActionScriptDefault_Text">objectGrid</span><span class="ActionScriptOperator">.</span><span class="ActionScriptDefault_Text">selectedItem</span><span class="ActionScriptOperator">.</span><span class="ActionScriptDefault_Text">FileCol</span>;
    <span class="ActionScriptDefault_Text">bitmapPath</span> <span class="ActionScriptOperator">=</span> <span class="ActionScriptString">"../images/"</span> <span class="ActionScriptOperator">+</span> <span class="ActionScriptDefault_Text">theFolder</span> <span class="ActionScriptOperator">+</span> <span class="ActionScriptString">"/000Tmb/"</span> <span class="ActionScriptOperator">+</span> <span class="ActionScriptDefault_Text">theClickName</span> <span class="ActionScriptOperator">+</span> <span class="ActionScriptString">".JPG"</span>;
<span class="ActionScriptBracket/Brace">}</span>


<span class="ActionScriptReserved">private</span> <span class="ActionScriptfunction">function</span> <span class="ActionScriptDefault_Text">saveImageToFileSystem</span><span class="ActionScriptBracket/Brace">(</span><span class="ActionScriptBracket/Brace">)</span>:<span class="ActionScriptReserved">void</span>
<span class="ActionScriptBracket/Brace">{</span>
    <span class="ActionScriptvar">var</span> <span class="ActionScriptDefault_Text">jPEGEncoder</span>:<span class="ActionScriptDefault_Text">JPEGEncoder</span> <span class="ActionScriptOperator">=</span> <span class="ActionScriptReserved">new</span> <span class="ActionScriptDefault_Text">JPEGEncoder</span><span class="ActionScriptBracket/Brace">(</span>500<span class="ActionScriptBracket/Brace">)</span>;
    <span class="ActionScriptvar">var</span> <span class="ActionScriptDefault_Text">imageSnapshot</span>:<span class="ActionScriptDefault_Text">ImageSnapshot</span> <span class="ActionScriptOperator">=</span> <span class="ActionScriptDefault_Text">ImageSnapshot</span><span class="ActionScriptOperator">.</span><span class="ActionScriptDefault_Text">captureImage</span><span class="ActionScriptBracket/Brace">(</span><span class="ActionScriptDefault_Text">img</span><span class="ActionScriptOperator">,</span> 0<span class="ActionScriptOperator">,</span> <span class="ActionScriptDefault_Text">jPEGEncoder</span><span class="ActionScriptBracket/Brace">)</span>;
    <span class="ActionScriptvar">var</span> <span class="ActionScriptDefault_Text">fileReference</span>:<span class="ActionScriptDefault_Text">FileReference</span> <span class="ActionScriptOperator">=</span> <span class="ActionScriptReserved">new</span> <span class="ActionScriptDefault_Text">FileReference</span><span class="ActionScriptBracket/Brace">(</span><span class="ActionScriptBracket/Brace">)</span>;
<span class="ActionScriptComment">//    fileReference.save(imageSnapshot.data, "img123.jpg");
</span><span class="ActionScriptBracket/Brace">}</span>
</pre></body>
</html>
